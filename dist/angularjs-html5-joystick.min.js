!function(){"use strict";var a=angular.module("joystick",[]),b=function(a,b){var c=b.id,d=document.getElementById(c),e={radius:d.width<d.height?d.width/2:d.height/2,center:{x:d.width/2,y:d.height/2}},f=2*e.radius/3,g=f/2,h=!1,i=function(a){var b=d.getContext("2d");b.clearRect(0,0,d.width,d.height),b.beginPath(),b.moveTo(0,e.center.y),b.lineTo(2*e.center.x,e.center.y),b.stroke(),b.beginPath(),b.moveTo(e.center.x,0),b.lineTo(e.center.x,2*e.center.y),b.stroke(),b.beginPath(),b.arc(e.center.x,e.center.y,f,0,2*Math.PI),b.stroke();var c=l(a),h=m(c);b.fillStyle="green",b.beginPath(),b.arc(h.x,h.y,g,0,2*Math.PI),b.fill()},j=function(a){var b={x:a.x-e.center.x,y:-1*(a.y-e.center.y)};return b},k=function(a){var b={angle:Math.atan2(a.y,a.x),magnitude:Math.sqrt(a.x*a.x+a.y*a.y)/f};return b.magnitude>1&&(b.magnitude=1),b},l=function(a){var b=a.magnitude*f,c={x:b*Math.cos(a.angle),y:b*Math.sin(a.angle)};return c},m=function(a){var b={x:a.x+e.center.x,y:e.center.y-a.y};return b},n=function(b){i(b),a.onMove({vector:b})};a.onTouchStart=function(){h=!0},a.onTouchEnd=function(){h=!1,o()},a.onTouchMove=function(a){if(h){var b=j(a),c=k(b);n(c)}};var o=function(){n({angle:0,magnitude:0})};o()},c=function(){return{restrict:"EA",scope:{id:"@",onMove:"&"},controller:b,link:function(a,b,c){b.on("touchstart",function(b){b.preventDefault(),a.onTouchStart()}),b.on("touchend",function(b){b.preventDefault(),a.onTouchEnd()}),b.on("touchmove",function(c){c.preventDefault();var d=window.event;if(d.targetTouches.length>0){var e=d.targetTouches[0],f=b.offset(),g=e.pageX-f.left,h=e.pageY-f.top,i={x:g,y:h};a.onTouchMove(i)}})}}};a.directive("joystick",c)}();